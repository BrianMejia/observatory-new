{% extends "base.html" %}

{% block title %}Calendar{% endblock %}

{% block head %}
<link href='https://unpkg.com/@fullcalendar/core/main.min.css' rel='stylesheet' />
<link href='https://unpkg.com/@fullcalendar/daygrid/main.min.css' rel='stylesheet' />

<script src='https://unpkg.com/@fullcalendar/core/main.min.js'></script>
<script src='https://unpkg.com/@fullcalendar/daygrid/main.min.js'></script>
<style>
</style>
{% endblock %}


{% block adminbuttons %}
{% match logged_in %}
{% when Some with (u) %}
{% if u.tier > 1 %}
<a class="btn btn-secondary" href="/calendar/new">New Event</a>
{% endif %}
{% when None %}
{% endmatch %}
{% endblock %}

{% block content %}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            plugins: ['dayGrid'],
            defaultView: 'dayGridMonth',
            themeSystem: 'bootstrap',
            events: {
                url: "/calendar.json",
                editable: false
            },
            eventDataTransform: (data) => ({ ...data, url: "/calendar/" + data.id })

        });

        calendar.render();
    });
</script>

<div id="calendar"></div>

<noscript>
    <table class="table table-hover">
        <thead>
            <th>Event Title</th>
            <th>Happening At</th>
        </thead>
        <tbody>
            {% for event in events %}
            <tr class="position-relative">
                <td><a class="stretched-link" href="/calendar/{{ event.id }}">{{ event.title }}</a></td>
                <td>{{ event.start }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</noscript>

{% endblock %}